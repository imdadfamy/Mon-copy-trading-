<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tg-blue { background-color: #2481cc; }
        .tg-dark { background-color: #17212b; }
        .tg-item { background-color: #242f3d; border-bottom: 1px solid #0e1621; }
        .tg-item:hover { background-color: #2b3949; }
        .hidden-item { display: none !important; }
    </style>
</head>
<body class="tg-dark text-white min-h-screen font-sans">
    <div class="max-w-md mx-auto shadow-2xl flex flex-col min-h-screen">
        <div class="tg-blue p-4 sticky top-0 z-10 shadow-lg">
            <h2 class="text-xl font-semibold mb-3">Choisir vos sources</h2>
            <div class="relative">
                <input type="text" id="channelSearch" placeholder="Rechercher un canal..." 
                    class="w-full p-2 pl-10 rounded-lg bg-black bg-opacity-20 border border-transparent focus:border-white focus:outline-none placeholder-blue-100 text-white">
                <span class="absolute left-3 top-2.5 opacity-70">üîç</span>
            </div>
        </div>

        <form action="/save-sources" method="post" class="flex-grow flex flex-col">
            <input type="hidden" name="user_id" value="{{ user_id }}">
            
            <div id="channelList" class="flex-grow overflow-y-auto">
                {% for channel in channels %}
                <label class="tg-item p-4 flex items-center cursor-pointer transition channel-row">
                    <div class="w-12 h-12 rounded-full bg-blue-600 flex-shrink-0 flex items-center justify-center text-xl font-bold mr-4 uppercase">
                        {{ channel.name[0] }}
                    </div>
                    <div class="flex-grow overflow-hidden">
                        <div class="font-bold truncate text-white channel-name">{{ channel.name }}</div>
                        <div class="text-gray-400 text-sm truncate">{{ channel.last_msg }}</div>
                    </div>
                    <input type="checkbox" name="selected_channels" value="{{ channel.id }}|{{ channel.name }}" class="w-6 h-6 rounded bg-gray-700 border-gray-600 text-blue-500">
                </label>
                {% endfor %}
            </div>

            <div class="p-4 bg-gray-900 border-t border-gray-800 sticky bottom-0">
                <button type="submit" class="w-full tg-blue hover:brightness-110 py-4 rounded-xl font-bold text-lg transition">
                    Activer la Copie Automatique
                </button>
            </div>
        </form>
    </div>

    <script>
        const searchInput = document.getElementById('channelSearch');
        const rows = document.querySelectorAll('.channel-row');

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();

            rows.forEach(row => {
                const name = row.querySelector('.channel-name').textContent.toLowerCase();
                if (name.includes(term)) {
                    row.classList.remove('hidden-item');
                } else {
                    row.classList.add('hidden-item');
                }
            });
        });
    </script>
</body>
</html>